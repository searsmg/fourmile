---
title: "Fourmile Calibrations and Output"
author: "Megan Sears"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    toc_float: yes
    theme: journal
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = F,
  message = F, 
  warning  = F)

library(tidyverse)
library(plotly)

```

# 10 most sensitive params

```{r}

statn <- read_csv('./data/sens_analysis/output_rsa_kge_runoff_statn.csv') %>%
  rename(statn_sens = sensitivity)

grid <- read_csv('./data/sens_analysis/output_rsa_kge_runoff_grid.csv') %>%
  rename(grid_sens = sensitivity)

join <- left_join(statn, grid, by ='parameter')

# rank them
join <- join %>%
  mutate(grid_rank = rank(-grid_sens),
         statn_rank = rank(-statn_sens),
         avg_rank = (grid_rank + statn_rank)/2) %>%
  arrange(avg_rank)

special <- join %>%
  slice(1:10)

####

# 10 most sensitive params
params <- read_csv('./38HRU_dec2024_updates/params_weighted_dec2024.csv')

params_filter <- params %>%
  filter(param %in% special$parameter)

```

# Burn and unburn params

```{r}

combo <- read_csv('./38HRU_dec2024_updates/params_burn_unburn.csv') %>%
  mutate(burn = if_else(burn == "yes", "Burned", "Unburned"),
         input_data = if_else(input_data =='grid', 
                              'Gridded',
                              'Station'))


ggplot(combo, aes(x = value, fill = input_data)) +
  geom_density(alpha = 0.6) +
  facet_wrap(burn ~ param, scales = "free") +
  theme_bw(base_size = 20) +
  scale_fill_manual(values = c("#0047AB", "orange")) +
  theme(
    strip.background = element_blank(),
    panel.grid = element_blank(),
    legend.position = "bottom"
  )


ggplot(combo, aes(x=burn, y=value, fill=input_data)) +
  #geom_violin(trim=T, scale='width', alpha=0.6) +
  geom_boxplot(alpha=0.8,
                outlier.colour = "black") +
  # stat_summary(fun.y=median, geom="point", size=2, color="black",
  #              position = position_dodge(width = 0.9)) +
  stat_compare_means(aes(group = input_data),
                     method = "wilcox.test", 
                     label = "p.signif",
                     hide.ns = T,
                     paired = F,
                     #label.y = 0,
                     #label.x = 1.4,
                     size = 7) +
  facet_wrap(~param, scales = 'free_y') +
  labs(y=element_blank(),
       x=element_blank()) +
  theme_bw(base_size=20) +
  scale_fill_manual(values = c("#0047AB", "orange")) +
    theme(
    legend.position = 'bottom',
    #legend.justification = c(0, 1.1), 
    legend.text = element_text(size = 16),
    legend.title = element_blank(), 
    panel.grid = element_blank(),
    panel.background = element_rect(fill = "white"),
    strip.background = element_blank(),
    text = element_text(color = "black"),
    axis.title = element_text(color = "black"),
    axis.text = element_text(color = "black"),
    #strip.text = element_blank()
  ) +
  scale_y_continuous(expand = expansion(mult = c(0.05, 0.15)))

```


