---
title: "Fourmile"
author: "Megan Sears"
date: "7/27/2022"
output:
  html_document:
    toc: true
    toc_float: true
    theme: journal
editor_options: 
  chunk_output_type: console
---

```{r open package, include=FALSE}

knitr::opts_chunk$set(warning = FALSE, message = FALSE) 

library(tidyverse)
library(dplyr)
library(lubridate)
library(plotly)
library(ggplot2)
library(here)
library(scales)
library(here)
```


```{r loading data, include=FALSE}
setwd('C:/Users/sears/Documents/Repos/fourmile/data')

#pull in all filenames with composite
filenames <- list.files('.', pattern='.csv', full.names=F)

#read all the csvs
dataframes <- lapply(filenames, read_csv)

#name all the csv
names(dataframes) <- substr(filenames, 1, 4)

#extract csvs from list to global env
lapply(names(dataframes), function(x) assign(x, dataframes[[x]], envir = .GlobalEnv))
rm(dataframes)

```

## Hydrographs 

```{r hydrographs, echo=F}
#daily streamflow
daily_q <- orun %>%
  select(-1) %>%
  filter(!row_number() %in% c(1:9, 11:15)) %>%
  set_names(as.character(slice(., 1))) %>%
  slice(-1) %>%
  replace(.==-9999, NA) %>%
  rename(ds3 = 2,
         usgs1 = 3,
         ds2 = 4,
         usgs2 = 5,
         us1 = 6,
         ds1 = 7) %>%
  mutate(date = mdy(date)) %>%
  pivot_longer(!date, names_to = 'site', values_to = 'q_m3s') %>%
  mutate(q_m3s = as.numeric(q_m3s))

hydro <- ggplot(daily_q, aes(x=date, y=q_m3s, color=site)) + geom_line() +
  ylim(0,8) + theme_bw() + 
  ggtitle('Daily streamflow (all)')

ggplotly(hydro)

#look at 2011-2013
hydro_datelimit <- ggplot(daily_q, aes(x=date, y=q_m3s, color=site)) + geom_line() + 
  theme_bw() + 
  scale_x_date(limits = as.Date(c('2011-01-01', '2014-01-01'))) +
  ylim(0,4) +
  ggtitle('Daily streamflow (2011-2013)')

ggplotly(hydro_datelimit)


```

## Precip

```{r precip, echo=F}
#daily precip
daily_p <- prec %>%
  filter(!row_number() %in% c(1:12, 14:17)) %>%
  set_names(as.character(slice(., 1))) %>%
  slice(-1) %>%
  select(-1) %>%
  replace(.==-9999, NA) %>%
  rename(date = 1) %>%
  mutate(date = mdy(date)) %>%
  pivot_longer(!date, names_to = 'site', values_to = 'precip_mm') %>%
  mutate(precip_mm = as.numeric(precip_mm))

precip <- ggplot(daily_p, aes(x=date, y=precip_mm, color=site)) + geom_line()  +
  theme_bw() +
  ggtitle('Daily precip')

ggplotly(precip)

#look at 2011-2013
precip_datelim <- ggplot(daily_p, aes(x=date, y=precip_mm, color=site)) + geom_line() + 
   scale_x_date(limits = as.Date(c('2011-01-01', '2014-01-01'))) +
  theme_bw() +
  ggtitle('Daily precip')

ggplotly(precip_datelim)

#monthly sums
monthlyp <- daily_p %>%
  group_by(site, year(date), month(date)) %>%
  summarize(precip_mo_mm = sum(precip_mm, na.rm=T),
            mo_yr = median(date))

mo_precip <- ggplot(monthlyp, aes(mo_yr, precip_mo_mm, color=site)) + geom_col(position ='dodge') +
  scale_x_date(limits = as.Date(c('2012-06-01', '2014-01-01'))) +
  ggtitle('Precip - monthly sum') + theme_bw()

ggplotly(mo_precip)
   
```

